<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Feedback ‚Äî Enviar</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{--bg:#f4f6f8;--card:#ffffff;--primary:#007bff;--danger:#dc3545;--muted:#6b7280}
  *{box-sizing:border-box}
  body{
    font-family:'Poppins',sans-serif;
    background:var(--bg);
    margin:0;
    padding:24px;
    display:flex;
    justify-content:center;
  }
  .container{width:100%;max-width:760px}
  h1{margin:0 0 18px;color:#222}
  .card{
    background:var(--card);
    border-radius:12px;
    padding:18px;
    box-shadow:0 6px 18px rgba(10,10,10,0.06);
    margin-bottom:14px;
  }

  form .row{display:flex;gap:10px;flex-wrap:wrap}
  label{font-weight:600;margin-bottom:6px;display:block;color:#222}
  input[type="text"], textarea, select{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid #d1d5db;
    font-size:15px;
    outline:none;
    background:#fff;
  }
  textarea{
    min-height:110px;
    resize:vertical;
    word-wrap: break-word;
    overflow-wrap: break-word;
    white-space: pre-wrap; /* preserva quebras dentro do textarea para a visual */
  }
  .opt-box{
    margin-top:8px;
    display:flex;
    gap:10px;
    align-items:center;
  }
  .opt{
    background:#f8fafc;
    border:1px solid #e6eefb;
    padding:10px 12px;
    border-radius:10px;
    display:flex;
    gap:8px;
    align-items:center;
    cursor:pointer;
    user-select:none;
  }
  .opt input{display:none}
  .opt.active{
    background:linear-gradient(90deg,var(--primary),#0056b3);
    color:#fff;
    border-color:#0056b3;
  }

  .actions{display:flex;gap:10px;margin-top:12px}
  button{
    background:var(--primary);
    color:#fff;
    border:none;
    border-radius:10px;
    padding:10px 14px;
    cursor:pointer;
    font-weight:600;
  }
  button.secondary{
    background:#eef2ff;
    color:var(--primary);
    border:1px solid rgba(0,123,255,0.12);
  }

  .icons-row{display:flex;gap:14px;align-items:center;margin-top:8px}
  .vis-card{
    flex:1;
    background:#fff;
    border-radius:10px;
    padding:12px;
    text-align:center;
    box-shadow:0 4px 12px rgba(10,10,10,0.06);
    cursor:pointer;
    transition:transform .12s;
    user-select:none;
  }
  .vis-card:hover{transform:translateY(-4px)}
  .vis-card .title{font-weight:700;margin-top:8px}
  .vis-card .count{color:var(--muted);margin-top:6px;font-size:13px}

  /* list area */
  .list-area{margin-top:14px}
  .list-item{
    background:#fff;border-radius:10px;padding:12px;margin-bottom:10px;box-shadow:0 4px 12px rgba(10,10,10,0.04)
  }
  .meta{font-size:13px;color:var(--muted);margin-bottom:6px}
  .msg{
    font-size:15px;
    line-height:1.4;
    color:#111;
    white-space: pre-wrap; /* preserva quebras de linha */
    word-wrap: break-word; 
    overflow-wrap: break-word;
    max-width: 100%;
  }

  .empty{padding:18px;text-align:center;color:var(--muted)}

  /* modal */
  .modal-backdrop{
    position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:60;
  }
  .modal{background:#fff;padding:18px;border-radius:12px;max-width:420px;width:92%;}
  .modal h3{margin:0 0 8px}
  .modal .row{margin-top:8px}
  .small{font-size:13px;color:var(--muted)}

  /* footer */
  .links{display:flex;gap:10px;align-items:center;margin-top:10px}
  a.link{color:var(--primary);text-decoration:none;font-weight:600}
  @media (max-width:520px){
    .icons-row{flex-direction:column}
  }
</style>
</head>
<body>
  <div class="container">
    <h1>üí¨ Enviar Feedback</h1>

    <div class="card">
      <form id="feedbackForm" autocomplete="off">
        <div>
          <label for="nome">Seu nome</label>
          <input id="nome" type="text" placeholder="Seu nome (opcional)">
        </div>

        <div style="margin-top:10px">
          <label for="mensagem">Mensagem</label>
          <textarea id="mensagem" placeholder="Escreva seu feedback aqui..." required></textarea>
          <p class="small" id="contador" style="margin-top:4px;">0/180 palavras</p>
        </div>

        <div style="margin-top:10px">
          <label>Visibilidade</label>
          <div class="opt-box" role="radiogroup" aria-label="Visibilidade">
            <label class="opt active" data-value="public">
              <input type="radio" name="vis" checked value="public">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M12 2a10 10 0 100 20 10 10 0 000-20z" stroke="currentColor" stroke-width="1.5"/></svg>
              <span>P√∫blico</span>
            </label>

            <label class="opt" data-value="private">
              <input type="radio" name="vis" value="private">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M12 3C8.1 3 5 6.1 5 10v3H4a1 1 0 00-1 1v5a2 2 0 002 2h14a2 2 0 002-2v-5a1 1 0 00-1-1h-1v-3c0-3.9-3.1-7-7-7z" stroke="currentColor" stroke-width="1.2"/></svg>
              <span>Privado</span>
            </label>
          </div>
          <div class="small" style="margin-top:8px">Privado: s√≥ aparece para quem souber a senha.</div>
        </div>

        <div class="actions">
          <button type="submit">Enviar</button>
          <button type="button" class="secondary" id="resetForm">Limpar</button>
        </div>

        <p class="small" id="status" style="margin-top:10px"></p>
      </form>
    </div>

    <!-- visualiza√ß√£o -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Visualiza√ß√µes</strong>
        <div class="small">Clique para ver</div>
      </div>

      <div class="icons-row" style="margin-top:10px">
        <div class="vis-card" id="viewPublic" title="Ver feedbacks p√∫blicos">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden>
            <path d="M12 4.5C7.305 4.5 3.485 7.068 1.5 11c1.985 3.932 5.805 6.5 10.5 6.5s8.515-2.568 10.5-6.5C20.515 7.068 16.695 4.5 12 4.5z" stroke="currentColor" stroke-width="1.2"/>
            <circle cx="12" cy="11" r="2.5" stroke="currentColor" stroke-width="1.2"/>
          </svg>
          <div class="title">P√∫blico</div>
          <div class="count" id="countPublic">0 feedbacks</div>
        </div>

        <div class="vis-card" id="viewPrivate" title="Ver feedbacks privados (senha)">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden>
            <rect x="3" y="8" width="18" height="11" rx="2" stroke="currentColor" stroke-width="1.2"/>
            <path d="M8 8V6a4 4 0 118 0v2" stroke="currentColor" stroke-width="1.2"/>
          </svg>
          <div class="title">Privado</div>
          <div class="count" id="countPrivate">0 feedbacks</div>
        </div>
      </div>

      <div class="list-area" id="listArea" style="margin-top:14px">
        <!-- feed list aparece aqui -->
        <div class="empty" id="emptyMsg">Clique em "P√∫blico" ou "Privado" para ver os feedbacks.</div>
        <div id="listContainer"></div>
      </div>

    </div>

    <div class="links">
      <a class="link" href="#" id="backBtn">‚¨ÖÔ∏è Voltar ao Painel</a>
      <a class="link" href="feedback-admin.html" style="margin-left:auto">Painel Admin</a>
    </div>
  </div>

  <!-- modal senha -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" role="dialog" aria-modal="true">
      <h3>Senha requerida</h3>
      <div class="small">Digite a senha para ver os feedbacks privados.</div>
      <div class="row" style="margin-top:10px">
        <input id="pwdInput" type="password" placeholder="Senha" />
      </div>
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
        <button id="pwdCancel" type="button" class="secondary">Cancelar</button>
        <button id="pwdOk" type="button">Verificar</button>
      </div>
      <p id="pwdMsg" class="small" style="margin-top:10px;color:var(--danger);display:none"></p>
    </div>
  </div>

<script>
/* CONFIG: altere a senha se quiser */
const ADMIN_PASSWORD = "admin123";

/* helpers */
function getFeedbacks(){ return JSON.parse(localStorage.getItem("feedbacks") || "[]"); }
function saveFeedbacks(fb){ localStorage.setItem("feedbacks", JSON.stringify(fb)); }
function formatDate(d){
  try{ return (new Date(d)).toLocaleString(); } catch(e) { return d; }
}

/* DOM refs */
const textarea = document.getElementById("mensagem");
const contador = document.getElementById("contador");
const status = document.getElementById("status");
const opts = Array.from(document.querySelectorAll(".opt"));
const listContainer = document.getElementById("listContainer");
const emptyMsg = document.getElementById("emptyMsg");
const modal = document.getElementById("modalBackdrop");
const pwdInput = document.getElementById("pwdInput");

/* word limit preserving newlines: 180 words */
function enforceWordLimitOn(text){
  const MAX = 180;
  const lines = text.split("\n");
  const limited = [];
  let total = 0;
  for (let line of lines){
    const words = line.trim().split(/\s+/).filter(w=>w.length>0);
    if(words.length === 0){
      // preserve blank line if still under limit
      if(total < MAX) limited.push("");
      continue;
    }
    if(total + words.length <= MAX){
      limited.push(line);
      total += words.length;
    } else if(total < MAX){
      const remain = MAX - total;
      limited.push(words.slice(0, remain).join(" "));
      total = MAX;
      break;
    } else {
      break;
    }
  }
  return { text: limited.join("\n"), count: Math.min(total, MAX) };
}

/* input handler */
textarea.addEventListener("input", ()=>{
  const val = textarea.value;
  const res = enforceWordLimitOn(val);
  if(res.text !== val){
    // only set value if changed (avoids caret jump when not needed)
    const pos = textarea.selectionStart;
    textarea.value = res.text;
    // try keep caret near end
    textarea.setSelectionRange(Math.min(pos, textarea.value.length), Math.min(pos, textarea.value.length));
  }
  contador.textContent = `${res.count}/180 palavras`;
});

/* opt behavior */
opts.forEach(opt=>{
  opt.addEventListener("click", ()=>{
    opts.forEach(o=>o.classList.remove("active"));
    opt.classList.add("active");
    opt.querySelector("input").checked = true;
  });
});

/* update counts UI */
function updateCounts(){
  const feedbacks = getFeedbacks();
  const pub = feedbacks.filter(f=>f.vis === "public").length;
  const priv = feedbacks.filter(f=>f.vis === "private").length;
  document.getElementById("countPublic").textContent = `${pub} feedback${pub!==1?'s':''}`;
  document.getElementById("countPrivate").textContent = `${priv} feedback${priv!==1?'s':''}`;
}

/* render list: create elements and use textContent for safety (pre-wrap handles newlines) */
function renderList(forType){
  listContainer.innerHTML = "";
  const feedbacks = getFeedbacks().filter(f=>f.vis === forType).sort((a,b)=>b.createdAt.localeCompare(a.createdAt));
  if(feedbacks.length === 0){
    emptyMsg.style.display = "block";
    emptyMsg.textContent = forType === "public" ? "Nenhum feedback p√∫blico ainda." : "Nenhum feedback privado.";
    return;
  }
  emptyMsg.style.display = "none";

  feedbacks.forEach(f=>{
    const item = document.createElement("div");
    item.className = "list-item";

    const meta = document.createElement("div");
    meta.className = "meta";
    const strong = document.createElement("strong");
    strong.textContent = f.nome;
    meta.appendChild(strong);
    const dateTxt = document.createTextNode(" ‚Ä¢ " + formatDate(f.createdAt));
    meta.appendChild(dateTxt);

    const msg = document.createElement("div");
    msg.className = "msg";
    // use textContent so we avoid any HTML injection; CSS preserves line breaks
    msg.textContent = f.mensagem;

    item.appendChild(meta);
    item.appendChild(msg);
    listContainer.appendChild(item);
  });
}

/* form submit */
document.getElementById("feedbackForm").addEventListener("submit", e=>{
  e.preventDefault();
  const nome = document.getElementById("nome").value.trim() || "An√¥nimo";
  const mensagem = document.getElementById("mensagem").value.trim();
  const vis = document.querySelector(".opt.active").getAttribute("data-value");
  if(!mensagem){
    status.textContent = "‚ö†Ô∏è Escreva uma mensagem antes de enviar.";
    return;
  }

  const feedbacks = getFeedbacks();
  feedbacks.push({
    id: Date.now().toString(36) + Math.random().toString(36).slice(2,6),
    nome,
    mensagem,
    vis,
    createdAt: new Date().toISOString()
  });
  saveFeedbacks(feedbacks);
  status.textContent = "‚úÖ Feedback enviado!";
  // reset form properly
  document.getElementById("feedbackForm").reset();
  opts.forEach(o=>o.classList.remove("active"));
  opts[0].classList.add("active");
  textarea.value = "";
  contador.textContent = "0/180 palavras";
  updateCounts();
  setTimeout(()=> status.textContent = "", 2600);
});

/* reset button */
document.getElementById("resetForm").addEventListener("click", ()=>{
  document.getElementById("feedbackForm").reset();
  opts.forEach(o=>o.classList.remove("active"));
  opts[0].classList.add("active");
  textarea.value = "";
  contador.textContent = "0/180 palavras";
  status.textContent = "";
});

/* private view flow */
document.getElementById("viewPublic").addEventListener("click", ()=>{ renderList("public"); });
document.getElementById("viewPrivate").addEventListener("click", ()=>{
  pwdInput.value = "";
  document.getElementById("pwdMsg").style.display = "none";
  modal.style.display = "flex";
  setTimeout(()=> pwdInput.focus(), 120);
});
document.getElementById("pwdCancel").addEventListener("click", ()=>{ modal.style.display = "none"; });
document.getElementById("pwdOk").addEventListener("click", verifyPwd);
pwdInput.addEventListener("keyup", e=>{ if(e.key === "Enter") verifyPwd(); });

function verifyPwd(){
  const val = pwdInput.value;
  const msg = document.getElementById("pwdMsg");
  if(val === ADMIN_PASSWORD){
    modal.style.display = "none";
    renderList("private");
  } else {
    msg.style.display = "block";
    msg.textContent = "Senha incorreta. Tente novamente.";
  }
}

/* back button behavior: volta no hist√≥rico se poss√≠vel, sen√£o redireciona */
const backBtn = document.getElementById("backBtn");
if(backBtn){
  backBtn.addEventListener("click", function(e){
    e.preventDefault();
    if(window.history.length > 1){
      window.history.back();
    } else {
      window.location.href = "painel.html";
    }
  });
}

/* init */
updateCounts();
document.addEventListener("DOMContentLoaded", ()=>{
  // ensure contador reflects current textarea (usually empty)
  const initial = enforceWordLimitOn(textarea.value || "");
  textarea.value = initial.text;
  contador.textContent = `${initial.count}/180 palavras`;
});
</script>
</body>
</html>